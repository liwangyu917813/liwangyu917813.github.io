<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>心动瞬间 - 模拟恋爱游戏</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF6B8B',
            secondary: '#8C52FF',
            accent: '#FF9F43',
            light: '#FFF2F9',
            dark: '#4A4A4A',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'bounce-slow': 'bounce 3s infinite',
            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .btn-secondary {
        @apply bg-secondary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-50;
      }
      .btn-outline {
        @apply border border-primary text-primary px-4 py-2 rounded-lg hover:bg-primary hover:text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .progress-bar {
        @apply h-2 rounded-full bg-gray-200 overflow-hidden;
      }
      .progress-value {
        @apply h-full bg-gradient-to-r from-primary to-secondary transition-all duration-500;
      }
      .dialog-box {
        @apply bg-white rounded-xl shadow-lg p-4 mb-4 max-w-lg mx-auto;
      }
      .character-card {
        @apply bg-white rounded-xl shadow-md overflow-hidden card-hover cursor-pointer;
      }
      .gift-card {
        @apply bg-white rounded-lg shadow p-3 card-hover cursor-pointer;
      }
      .job-card {
        @apply bg-white rounded-lg shadow p-3 card-hover cursor-pointer;
      }
    }
  </style>
</head>
<body class="bg-light min-h-screen font-sans text-dark">
  <!-- 游戏容器 -->
  <div id="game-container" class="max-w-6xl mx-auto px-4 py-8">
    
    <!-- 顶部导航栏 -->
    <header class="flex justify-between items-center mb-8">
      <div class="flex items-center">
        <h1 class="text-3xl font-bold text-primary mr-4">心动瞬间</h1>
        <span class="bg-accent text-white text-sm px-3 py-1 rounded-full">模拟恋爱游戏</span>
      </div>
      <div class="flex items-center space-x-4">
        <div class="flex items-center">
          <i class="fa fa-money text-green-600 mr-1"></i>
          <span id="money-display" class="font-bold">500</span>
          <span class="text-sm">元</span>
        </div>
        <div class="flex items-center">
          <i class="fa fa-calendar text-blue-600 mr-1"></i>
          <span id="day-display" class="font-bold">1</span>
          <span class="text-sm">天</span>
        </div>
      </div>
    </header>
    
    <!-- 主游戏区域 -->
    <main>
      <!-- 页面容器 - 所有页面都在这里切换 -->
      <div id="page-container">
        
        <!-- 角色选择页面 -->
        <section id="character-selection-page" class="page active">
          <h2 class="text-2xl font-bold mb-6 text-center">选择你心仪的对象</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 角色A -->
            <div class="character-card" data-character="0">
              <div class="relative">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/51b69d279e4943028d5bbfc9e25ca362.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=womRcKMGS7klMrjKmwsXdf78nZM%3D" 
                     alt="角色A" class="w-full h-64 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                  <h3 class="text-white text-xl font-bold">啵啵姐</h3>
                  <p class="text-white text-sm">知性御姐 · 图书馆管理员</p>
                </div>
              </div>
              <div class="p-4">
                <p class="text-sm text-gray-600 mb-3">优雅知性，热爱阅读，总是在图书馆的角落里安静地看书。</p>
                <div class="flex justify-end">
                  <button class="btn-primary text-sm">开始攻略</button>
                </div>
              </div>
            </div>
            
            <!-- 角色B -->
            <div class="character-card" data-character="1">
              <div class="relative">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/cd2d7d88c7ce4fb491c282aa359de240.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=lqt58sUJrMXZM7uE19AMAcVBHso%3D" 
                     alt="角色B" class="w-full h-64 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                  <h3 class="text-white text-xl font-bold">鹏哥</h3>
                  <p class="text-white text-sm">神秘酷哥 · 体育教练</p>
                </div>
              </div>
              <div class="p-4">
                <p class="text-sm text-gray-600 mb-3">沉默寡言，身手矫健，总是戴着墨镜，没人知道他的过去。</p>
                <div class="flex justify-end">
                  <button class="btn-primary text-sm">开始攻略</button>
                </div>
              </div>
            </div>
            
            <!-- 角色C -->
            <div class="character-card" data-character="2">
              <div class="relative">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/c6d542f684ce42f5ab91cd7d6ee64fde.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=O0OZgejwvXJhQguwKC5lRpNdgOo%3D" 
                     alt="角色C" class="w-full h-64 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                  <h3 class="text-white text-xl font-bold">香波哥</h3>
                  <p class="text-white text-sm">成熟稳重 · 公司总裁</p>
                </div>
              </div>
              <div class="p-4">
                <p class="text-sm text-gray-600 mb-3">事业有成，温文尔雅，举手投足间都散发着成熟男人的魅力。</p>
                <div class="flex justify-end">
                  <button class="btn-primary text-sm">开始攻略</button>
                </div>
              </div>
            </div>
            
            <!-- 角色D -->
            <div class="character-card" data-character="3">
              <div class="relative">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f62afbbe16204edfb46496c5c0f1ca55.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=IIZ5v1w%2FhfBrw5l2ShG8V%2BwGrsA%3D" 
                     alt="角色D" class="w-full h-64 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                  <h3 class="text-white text-xl font-bold">晶晶姐</h3>
                  <p class="text-white text-sm">温柔可爱 · 甜点师</p>
                </div>
              </div>
              <div class="p-4">
                <p class="text-sm text-gray-600 mb-3">心地善良，笑容甜美，擅长制作各种美味的甜点。</p>
                <div class="flex justify-end">
                  <button class="btn-primary text-sm">开始攻略</button>
                </div>
              </div>
            </div>
            
            <!-- 角色E -->
            <div class="character-card" data-character="4">
              <div class="relative">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/0d90c2dd2c8a4da78ba023a3da191596.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=ylMfctaeAa4Vs5yPvVEkgKj0b8M%3D" 
                     alt="角色E" class="w-full h-64 object-cover">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                  <h3 class="text-white text-xl font-bold">飞飞哥</h3>
                  <p class="text-white text-sm">阳光开朗 · 音乐教师</p>
                </div>
              </div>
              <div class="p-4">
                <p class="text-sm text-gray-600 mb-3">热情洋溢，多才多艺，总能给身边的人带来快乐。</p>
                <div class="flex justify-end">
                  <button class="btn-primary text-sm">开始攻略</button>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 角色互动页面 -->
        <section id="character-interaction-page" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <button id="back-to-selection" class="btn-outline flex items-center">
              <i class="fa fa-arrow-left mr-2"></i> 返回列表
            </button>
            <div class="flex space-x-2">
              <button id="work-btn" class="btn-secondary flex items-center">
                <i class="fa fa-briefcase mr-2"></i> 打工
              </button>
              <button id="gift-btn" class="btn-primary flex items-center">
                <i class="fa fa-gift mr-2"></i> 送礼
              </button>
              <button id="date-btn" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-opacity-50 flex items-center">
                <i class="fa fa-heart mr-2"></i> 约会
              </button>
              <button id="diary-btn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-opacity-50 flex items-center">
                <i class="fa fa-book mr-2"></i> 日记
              </button>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧：角色信息 -->
            <div class="lg:col-span-1">
              <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="relative">
                  <img id="character-detail-image" src="" alt="角色详情" class="w-full h-64 object-cover">
                  <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4">
                    <h3 id="character-detail-name" class="text-white text-xl font-bold">角色名称</h3>
                    <p id="character-detail-title" class="text-white text-sm">角色头衔</p>
                  </div>
                </div>
                <div class="p-4">
                  <div class="mb-4">
                    <div class="flex justify-between mb-1">
                      <span class="text-sm font-medium">好感度</span>
                      <span id="affection-value" class="text-sm font-bold">0/100</span>
                    </div>
                    <div class="progress-bar">
                      <div id="affection-bar" class="progress-value" style="width: 0%"></div>
                    </div>
                  </div>
                  
                  <div class="mb-4">
                    <h4 class="font-bold text-sm mb-2">线索</h4>
                    <div id="character-clues" class="flex flex-wrap gap-1">
                      <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">暂无线索</span>
                    </div>
                  </div>
                  
                  <div>
                    <h4 class="font-bold text-sm mb-2">性格</h4>
                    <p id="character-personality" class="text-sm text-gray-600">角色性格描述</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 右侧：互动区域 -->
            <div class="lg:col-span-2">
              <!-- 对话区域 -->
              <div id="dialog-section" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold mb-4">对话</h3>
                
                <div id="dialog-container" class="h-80 overflow-y-auto mb-4 p-4 bg-gray-50 rounded-lg">
                  <!-- 对话内容将通过JS动态添加 -->
                </div>
                
                <div id="dialog-options" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <!-- 对话选项将通过JS动态添加 -->
                </div>
              </div>
              
              <!-- 送礼区域 (默认隐藏) -->
              <div id="gift-section" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">赠送礼物</h3>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                  <!-- 礼物卡片将通过JS动态添加 -->
                </div>
              </div>
              
              <!-- 打工区域 (默认隐藏) -->
              <div id="work-section" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">打工赚钱</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <!-- 打工选项将通过JS动态添加 -->
                </div>
              </div>
              
              <!-- 约会区域 (默认隐藏) -->
              <div id="date-section" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">约会</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <!-- 约会选项将通过JS动态添加 -->
                </div>
              </div>
              
              <!-- 日记区域 (默认隐藏) -->
              <div id="diary-section" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">日记</h3>
                
                <div class="mb-4">
                  <h4 class="font-bold text-sm mb-2">线索收集</h4>
                  <div id="diary-clues" class="p-4 bg-gray-50 rounded-lg min-h-[100px]">
                    <p class="text-gray-500">你还没有收集到任何线索...</p>
                  </div>
                </div>
                
                <div>
                  <h4 class="font-bold text-sm mb-2">互动记录</h4>
                  <div id="diary-interactions" class="p-4 bg-gray-50 rounded-lg min-h-[200px]">
                    <p class="text-gray-500">你还没有与任何人互动...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- 结局页面 -->
        <section id="ending-page" class="page hidden">
          <div class="bg-white rounded-xl shadow-lg p-8 max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold mb-6 text-center">游戏结局</h2>
            
            <div class="mb-6 text-center">
              <img id="ending-image" src="" alt="结局图片" class="w-64 h-64 object-cover rounded-full mx-auto mb-4 border-4 border-primary">
              <h3 id="ending-title" class="text-xl font-bold text-primary mb-2">结局标题</h3>
              <p id="ending-description" class="text-gray-600">结局描述</p>
            </div>
            
            <div class="text-center">
              <button id="restart-game" class="btn-primary">重新开始</button>
            </div>
          </div>
        </section>
      </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="mt-12 text-center text-sm text-gray-500">
      <p>心动瞬间 &copy; 2025 模拟恋爱游戏</p>
    </footer>
  </div>
  
  <!-- 游戏数据和逻辑 -->
  <script>
    // 游戏数据
    const gameData = {
      money: 500,
      day: 1,
      currentCharacter: null,
      clues: [],
      interactions: [],
      characters: [
        {
          id: 0,
          name: "啵啵姐",
          title: "知性御姐 · 图书馆管理员",
          image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/51b69d279e4943028d5bbfc9e25ca362.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=womRcKMGS7klMrjKmwsXdf78nZM%3D",
          personality: "优雅知性，热爱爱阅读，总是在图书馆的角落里安静地看书。",
          likes: ["书籍", "咖啡", "音乐"],
          affection: 0,
          dialogues: [
            {
              id: 0,
              text: "你好，我是啵啵姐，很高兴认识你。",
              options: [
                { text: "你好，我也很高兴认识你。", affectionChange: 2 },
                { text: "图书馆的书真多啊。", affectionChange: 3 },
                { text: "你看起来很严肃。", affectionChange: -1 }
              ]
            },
            {
              id: 1,
              text: "我喜欢在这里工作，安静的环境能让我静下心来阅读。",
              options: [
                { text: "我也喜欢安静的环境。", affectionChange: 2 },
                { text: "你喜欢看什么类型的书？", affectionChange: 3 },
                { text: "安静的地方有点无聊。", affectionChange: -1 }
              ]
            },
            {
              id: 2,
              text: "我最近在看一些关于心理学的书籍，很有意思。",
              options: [
                { text: "心理学确实很有趣。", affectionChange: 3 },
                { text: "我对心理学不太了解。", affectionChange: 1 },
                { text: "看书不如看电影。", affectionChange: -2 }
              ]
            },
            {
              id: 3,
              text: "下班后我喜欢去附近的咖啡馆，那里的拿铁很棒。",
              options: [
                { text: "我也喜欢喝咖啡。", affectionChange: 3 },
                { text: "咖啡对身体不好。", affectionChange: -1 },
                { text: "我更喜欢喝茶。", affectionChange: 1 }
              ]
            },
            {
              id: 4,
              text: "周末的时候，我会在家听音乐，放松一下。",
              options: [
                { text: "你喜欢什么类型的音乐？", affectionChange: 3 },
                { text: "周末应该出去走走。", affectionChange: 1 },
                { text: "音乐太吵了。", affectionChange: -2 }
              ]
            }
          ]
        },
        {
          id: 1,
          name: "鹏哥",
          title: "神秘酷哥 · 体育教练",
          image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/cd2d7d88c7ce4fb491c282aa359de240.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=lqt58sUJrMXZM7uE19AMAcVBHso%3D",
          personality: "沉默寡言，身手矫健，总是戴着墨镜，没人知道他的过去。",
          likes: ["运动", "游戏", "电子产品"],
          affection: 0,
          dialogues: [
            {
              id: 0,
              text: "嗯？有事吗？",
              options: [
                { text: "你好，我想认识你。", affectionChange: 1 },
                { text: "你看起来很酷。", affectionChange: 2 },
                { text: "你为什么总是戴着墨镜？", affectionChange: -1 }
              ]
            },
            {
              id: 1,
              text: "我是这里的体育教练，负责指导学员的训练。",
              options: [
                { text: "你看起来很强壮。", affectionChange: 2 },
                { text: "体育教练很辛苦吧？", affectionChange: 1 },
                { text: "我对运动没兴趣。", affectionChange: -2 }
              ]
            },
            {
              id: 2,
              text: "下班后我喜欢在家玩游戏，放松一下。",
              options: [
                { text: "你喜欢玩什么游戏？", affectionChange: 3 },
                { text: "玩游戏不如运动。", affectionChange: -1 },
                { text: "我也喜欢玩游戏。", affectionChange: 3 }
              ]
            },
            {
              id: 3,
              text: "我对电子产品很感兴趣，经常更新我的设备。",
              options: [
                { text: "最新的手机是什么型号？", affectionChange: 3 },
                { text: "电子产品更新太快了。", affectionChange: 1 },
                { text: "我对电子产品没兴趣。", affectionChange: -2 }
              ]
            },
            {
              id: 4,
              text: "周末我会去郊外跑步，那里的空气很好。",
              options: [
                { text: "我可以和你一起去吗？", affectionChange: 3 },
                { text: "跑步太累了。", affectionChange: -1 },
                { text: "周末我更喜欢在家休息。", affectionChange: 1 }
              ]
            }
          ]
        },
        {
          id: 2,
          name: "香波哥",
          title: "成熟稳重 · 公司总裁",
          image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/c6d542f684ce42f5ab91cd7d6ee64fde.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=O0OZgejwvXJhQguwKC5lRpNdgOo%3D",
          personality: "事业有成，温文尔雅，举手投足间都散发着成熟男人的魅力。",
          likes: ["红酒", "书法", "古典艺术"],
          affection: 0,
          dialogues: [
            {
              id: 0,
              text: "你好，我是香波哥，很高兴认识你。",
              options: [
                { text: "你好，我也很高兴认识你。", affectionChange: 2 },
                { text: "王总看起来很有气质。", affectionChange: 3 },
                { text: "总裁都这么忙吗？", affectionChange: 1 }
              ]
            },
            {
              id: 1,
              text: "工作确实很忙，但我会尽量抽出时间享受生活。",
              options: [
                { text: "王总真会生活。", affectionChange: 2 },
                { text: "工作最重要。", affectionChange: 1 },
                { text: "我觉得生活比工作重要。", affectionChange: 2 }
              ]
            },
            {
              id: 2,
              text: "我喜欢收藏红酒，有空可以一起品尝。",
              options: [
                { text: "我很乐意。", affectionChange: 3 },
                { text: "我对红酒不太了解。", affectionChange: 1 },
                { text: "我不喜欢喝酒。", affectionChange: -2 }
              ]
            },
            {
              id: 3,
              text: "闲暇时我会练习书法，这能让我静下心来。",
              options: [
                { text: "书法是中国传统文化的瑰宝。", affectionChange: 3 },
                { text: "现在很少有人练书法了。", affectionChange: 1 },
                { text: "书法太枯燥了。", affectionChange: -1 }
              ]
            },
            {
              id: 4,
              text: "我经常去看画展，古典艺术总能给我启发。",
              options: [
                { text: "我也喜欢古典艺术。", affectionChange: 3 },
                { text: "我更喜欢现代艺术。", affectionChange: 1 },
                { text: "艺术对我来说太深奥了。", affectionChange: -1 }
              ]
            }
          ]
        },
        {
          id: 3,
          name: "晶晶姐",
          title: "温柔可爱 · 甜点师",
          image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f62afbbe16204edfb46496c5c0f1ca55.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=IIZ5v1w%2FhfBrw5l2ShG8V%2BwGrsA%3D",
          personality: "心地善良，笑容甜美，擅长制作各种美味的甜点。",
          likes: ["甜点", "小动物", "手工制品"],
          affection: 0,
          dialogues: [
            {
              id: 0,
              text: "你好！欢迎来到我的甜点店！",
              options: [
                { text: "你好，你的店真可爱。", affectionChange: 3 },
                { text: "我想买点甜点。", affectionChange: 2 },
                { text: "甜点会让人发胖吧？", affectionChange: -1 }
              ]
            },
            {
              id: 1,
              text: "我最喜欢制作甜点了，看到别人吃得开心我也会很快乐。",
              options: [
                { text: "你的笑容真甜美。", affectionChange: 3 },
                { text: "你做的甜点看起来很好吃。", affectionChange: 2 },
                { text: "做甜点一定很麻烦吧？", affectionChange: 1 }
              ]
            },
            {
              id: 2,
              text: "我养了一只小猫，它很可爱，有空可以来看它。",
              options: [
                { text: "我很喜欢小猫！", affectionChange: 3 },
                { text: "我对小动物过敏。", affectionChange: -1 },
                { text: "我更喜欢小狗。", affectionChange: 1 }
              ]
            },
            {
              id: 3,
              text: "周末我会做一些手工制品，比如编织和陶艺。",
              options: [
                { text: "手工制品很有意义。", affectionChange: 2 },
                { text: "我也喜欢做手工。", affectionChange: 3 },
                { text: "手工制品太费时间了。", affectionChange: -1 }
              ]
            },
            {
              id: 4,
              text: "我最近在研究新的甜点配方，你想尝尝看吗？",
              options: [
                { text: "当然想！", affectionChange: 3 },
                { text: "甜点吃多了会胖。", affectionChange: -1 },
                { text: "我比较喜欢咸的食物。", affectionChange: 1 }
              ]
            }
          ]
        },
        {
          id: 4,
          name: "飞飞哥",
          title: "阳光开朗 · 音乐教师",
          image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/0d90c2dd2c8a4da78ba023a3da191596.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=ylMfctaeAa4Vs5yPvVEkgKj0b8M%3D",
          personality: "热情洋溢，多才多艺，总能给身边的人带来快乐。",
          likes: ["户外活动", "乐器", "摄影"],
          affection: 0,
          dialogues: [
            {
              id: 0,
              text: "嗨！我是飞飞哥，很高兴认识你！",
              options: [
                { text: "你好，我也很高兴认识你！", affectionChange: 2 },
                { text: "你看起来很阳光。", affectionChange: 3 },
                { text: "你好，有什么事吗？", affectionChange: 1 }
              ]
            },
            {
              id: 1,
              text: "我是一名音乐教师，喜欢教孩子们唱歌和演奏乐器。",
              options: [
                { text: "音乐教师真伟大。", affectionChange: 2 },
                { text: "你会演奏什么乐器？", affectionChange: 3 },
                { text: "我对音乐没兴趣。", affectionChange: -2 }
              ]
            },
            {
              id: 2,
              text: "周末我喜欢去郊外徒步，呼吸新鲜空气。",
              options: [
                { text: "我也喜欢户外活动！", affectionChange: 3 },
                { text: "户外活动太累了。", affectionChange: -1 },
                { text: "我更喜欢室内活动。", affectionChange: 1 }
              ]
            },
            {
              id: 3,
              text: "我喜欢摄影，走到哪里都会带着相机。",
              options: [
                { text: "你拍的照片一定很好看。", affectionChange: 2 },
                { text: "我也喜欢摄影。", affectionChange: 3 },
                { text: "现在手机拍照就够了。", affectionChange: 1 }
              ]
            },
            {
              id: 4,
              text: "我最近在学习弹吉他，有机会弹给你听。",
              options: [
                { text: "好啊，我很期待！", affectionChange: 3 },
                { text: "吉他太难学了。", affectionChange: 1 },
                { text: "我更喜欢钢琴。", affectionChange: 2 }
              ]
            }
          ]
        }
      ],
      gifts: [
        { id: 0, name: "鲜花", price: 50, affectionChange: 2, likedBy: [0, 3], reaction: "他/她接过鲜花，脸上露出了微笑。" },
        { id: 1, name: "巧克力", price: 80, affectionChange: 3, likedBy: [0, 3], reaction: "他/她看到巧克力，眼睛一亮。" },
        { id: 2, name: "书籍", price: 100, affectionChange: 4, likedBy: [0], reaction: "他/她对这本书很感兴趣，翻看了几页。" },
        { id: 3, name: "咖啡", price: 50, affectionChange: 3, likedBy: [0], reaction: "他/她接过咖啡，闻了闻，露出满意的表情。" },
        { id: 4, name: "运动手环", price: 200, affectionChange: 5, likedBy: [1], reaction: "他/她对这个运动手环很感兴趣，立刻戴在了手上。" },
        { id: 5, name: "游戏手柄", price: 300, affectionChange: 6, likedBy: [1], reaction: "他/她看到游戏手柄，兴奋地问你要不要一起玩。" },
        { id: 6, name: "红酒", price: 500, affectionChange: 8, likedBy: [2], reaction: "他/她对红酒很有研究，和你聊了很多关于红酒的知识。" },
        { id: 7, name: "书法套装", price: 300, affectionChange: 7, likedBy: [2], reaction: "他/她看到书法套装，赞赏地看着你。" },
        { id: 8, name: "手工蛋糕", price: 150, affectionChange: 5, likedBy: [3], reaction: "他/她尝了一口蛋糕，开心地笑了起来。" },
        { id: 9, name: "猫咪玩偶", price: 100, affectionChange: 4, likedBy: [3], reaction: "他/她抱着猫咪玩偶，看起来很开心。" },
        { id: 10, name: "登山包", price: 400, affectionChange: 6, likedBy: [4], reaction: "他/她对登山包很满意，说下次户外活动可以用上。" },
        { id: 11, name: "相机", price: 1000, affectionChange: 10, likedBy: [4], reaction: "他/她看到相机，激动地说这是他/她一直想要的型号。" }
      ],
      dates: [
        { id: 0, name: "电影院", price: 100, time: 2, likedBy: [0, 3], description: "一起去看最新上映的电影", reactions: {
          like: "他/她看得很投入，偶尔会和你分享观后感。",
          dislike: "他/她看起来对这部电影不太感兴趣，有些走神。"
        }},
        { id: 1, name: "公园散步", price: 50, time: 1, likedBy: [0, 4], description: "在公园散步，享受大自然的美景", reactions: {
          like: "他/她很享受散步的时光，和你聊了很多话题。",
          dislike: "他/她看起来有些累，不太适应长时间的步行。"
        }},
        { id: 2, name: "健身房", price: 150, time: 2, likedBy: [1], description: "一起去健身房锻炼", reactions: {
          like: "他/她在健身房里表现出色，还指导了你一些动作。",
          dislike: "他/她看起来不太习惯在别人面前锻炼。"
        }},
        { id: 3, name: "美术馆", price: 80, time: 2, likedBy: [0, 2], description: "参观最新的艺术展览", reactions: {
          like: "他/她对艺术很有见解，给你讲解了很多作品的背景。",
          dislike: "他/她对艺术不太感兴趣，只是随便看看。"
        }},
        { id: 4, name: "音乐会", price: 200, time: 3, likedBy: [0, 4], description: "聆听高雅的音乐会", reactions: {
          like: "他/她听得很入迷，结束后还和你讨论了很久。",
          dislike: "他/她看起来不太适应这种场合，有些坐立不安。"
        }},
        { id: 5, name: "餐厅", price: 300, time: 2, likedBy: [2, 3], description: "在高档餐厅享用美食", reactions: {
          like: "他/她对这里的食物很满意，尤其喜欢某道菜。",
          dislike: "他/她看起来对这里的食物不太习惯。"
        }}
      ],
      jobs: [
        { id: 0, name: "快餐店兼职", pay: 50, time: 1, description: "简单的体力劳动，收入不高但稳定。" },
        { id: 1, name: "家教", pay: 100, time: 2, description: "辅导学生功课，需要一定的知识水平。" },
        { id: 2, name: "自由职业", pay: 200, time: 3, description: "接一些设计或写作的活儿，收入较高但不稳定。" }
      ],
      endings: [
        { id: 0, title: "陌生人", description: "你们只是认识而已，没有深入的交流。", affectionRequired: 0, image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/51b69d279e4943028d5bbfc9e25ca362.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=womRcKMGS7klMrjKmwsXdf78nZM%3D" },
        { id: 1, title: "普通朋友", description: "你们成为了普通朋友，偶尔会一起聊天。", affectionRequired: 20, image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/cd2d7d88c7ce4fb491c282aa359de240.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=lqt58sUJrMXZM7uE19AMAcVBHso%3D" },
        { id: 2, title: "好朋友", description: "你们是很好的朋友，经常一起参加各种活动。", affectionRequired: 50, image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/c6d542f684ce42f5ab91cd7d6ee64fde.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=O0OZgejwvXJhQguwKC5lRpNdgOo%3D" },
        { id: 3, title: "暧昧关系", description: "你们之间有着微妙的情愫，但还没有捅破那层窗户纸。", affectionRequired: 70, image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f62afbbe16204edfb46496c5c0f1ca55.jpeg~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=IIZ5v1w%2FhfBrw5l2ShG8V%2BwGrsA%3D" },
        { id: 4, title: "恋人", description: "恭喜！你们成为了恋人，一起度过了许多美好的时光。", affectionRequired: 90, image: "https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/0d90c2dd2c8a4da78ba023a3da191596.png~tplv-a9rns2rl98-24:720:720.jpeg?rcl=202511021920054FFF42CCAC7804EEC2A5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1762687205&x-signature=ylMfctaeAa4Vs5yPvVEkgKj0b8M%3D" }
      ]
    };
    
    // 游戏状态
    const gameState = {
      currentDialogueId: 0,
      currentSection: 'dialog' // 'dialog', 'gift', 'work', 'date', 'diary'
    };
    
    // DOM 元素
    const pages = {
      characterSelection: document.getElementById('character-selection-page'),
      characterInteraction: document.getElementById('character-interaction-page'),
      ending: document.getElementById('ending-page')
    };
    
    const characterElements = {
      detailImage: document.getElementById('character-detail-image'),
      detailName: document.getElementById('character-detail-name'),
      detailTitle: document.getElementById('character-detail-title'),
      affectionValue: document.getElementById('affection-value'),
      affectionBar: document.getElementById('affection-bar'),
      personality: document.getElementById('character-personality')
    };
    
    const sections = {
      dialog: document.getElementById('dialog-section'),
      gift: document.getElementById('gift-section'),
      work: document.getElementById('work-section'),
      date: document.getElementById('date-section'),
      diary: document.getElementById('diary-section')
    };
    
    const dialogElements = {
      container: document.getElementById('dialog-container'),
      options: document.getElementById('dialog-options')
    };
    
    const uiElements = {
      moneyDisplay: document.getElementById('money-display'),
      dayDisplay: document.getElementById('day-display'),
      backToSelectionBtn: document.getElementById('back-to-selection'),
      giftBtn: document.getElementById('gift-btn'),
      workBtn: document.getElementById('work-btn'),
      dateBtn: document.getElementById('date-btn'),
      diaryBtn: document.getElementById('diary-btn'),
      restartGameBtn: document.getElementById('restart-game'),
      endingImage: document.getElementById('ending-image'),
      endingTitle: document.getElementById('ending-title'),
      endingDescription: document.getElementById('ending-description'),
      diaryClues: document.getElementById('diary-clues'),
      diaryInteractions: document.getElementById('diary-interactions')
    };
    
    // 初始化游戏
    function initGame() {
      // 加载保存的游戏数据
      loadGame();
      
      // 更新UI
      updateUI();
      
      // 添加事件监听器
      addEventListeners();
    }
    
    // 加载游戏数据
    function loadGame() {
      const savedData = localStorage.getItem('loveSimulationGame');
      if (savedData) {
        const parsedData = JSON.parse(savedData);
        gameData.money = parsedData.money;
        gameData.day = parsedData.day;
        gameData.currentCharacter = parsedData.currentCharacter;
        gameData.clues = parsedData.clues || [];
        gameData.interactions = parsedData.interactions || [];
        
        // 加载角色数据
        for (let i = 0; i < gameData.characters.length; i++) {
          if (parsedData.characters && parsedData.characters[i]) {
            gameData.characters[i].affection = parsedData.characters[i].affection;
          }
        }
      }
      
      // 如果有当前角色，显示互动页面
      if (gameData.currentCharacter !== null) {
        showCharacterInteractionPage(gameData.currentCharacter);
      }
    }
    
    // 保存游戏数据
    function saveGame() {
      const dataToSave = {
        money: gameData.money,
        day: gameData.day,
        currentCharacter: gameData.currentCharacter,
        clues: gameData.clues,
        interactions: gameData.interactions,
        characters: gameData.characters.map(character => ({
          id: character.id,
          affection: character.affection
        }))
      };
      
      localStorage.setItem('loveSimulationGame', JSON.stringify(dataToSave));
    }
    
    // 更新UI
    function updateUI() {
      // 更新金钱和日期
      uiElements.moneyDisplay.textContent = gameData.money;
      uiElements.dayDisplay.textContent = gameData.day;
      
      // 如果有当前角色，更新角色信息
      if (gameData.currentCharacter !== null) {
        const character = gameData.characters[gameData.currentCharacter];
        characterElements.affectionValue.textContent = `${character.affection}/100`;
        characterElements.affectionBar.style.width = `${character.affection}%`;
      }
    }
    
    // 添加事件监听器
    function addEventListeners() {
      // 角色选择
      document.querySelectorAll('.character-card').forEach(card => {
        card.addEventListener('click', () => {
          const characterId = parseInt(card.dataset.character);
          showCharacterInteractionPage(characterId);
        });
      });
      
      // 返回角色列表
      uiElements.backToSelectionBtn.addEventListener('click', () => {
        showCharacterSelectionPage();
      });
      
      // 送礼按钮
      uiElements.giftBtn.addEventListener('click', () => {
        showSection('gift');
        renderGiftSection();
      });
      
      // 打工按钮
      uiElements.workBtn.addEventListener('click', () => {
        showSection('work');
        renderWorkSection();
      });
      
      // 约会按钮
      uiElements.dateBtn.addEventListener('click', () => {
        showSection('date');
        renderDateSection();
      });
      
      // 日记按钮
      uiElements.diaryBtn.addEventListener('click', () => {
        showSection('diary');
        updateDiary();
      });
      
      // 重新开始游戏
      uiElements.restartGameBtn.addEventListener('click', () => {
        restartGame();
      });
    }
    
    // 显示角色选择页面
    function showCharacterSelectionPage() {
      hideAllPages();
      pages.characterSelection.classList.remove('hidden');
      gameData.currentCharacter = null;
      saveGame();
    }
    
    // 显示角色互动页面
    function showCharacterInteractionPage(characterId) {
      hideAllPages();
      pages.characterInteraction.classList.remove('hidden');
      
      gameData.currentCharacter = characterId;
      const character = gameData.characters[characterId];
      
      // 更新角色信息
      characterElements.detailImage.src = character.image;
      characterElements.detailName.textContent = character.name;
      characterElements.detailTitle.textContent = character.title;
      characterElements.affectionValue.textContent = `${character.affection}/100`;
      characterElements.affectionBar.style.width = `${character.affection}%`;
      characterElements.personality.textContent = character.personality;
      
      // 更新线索
      updateCharacterClues();
      
      // 显示对话区域
      showSection('dialog');
      renderDialogSection();
      
      // 保存游戏
      saveGame();
    }
    
    // 显示结局页面
    function showEndingPage() {
      hideAllPages();
      pages.ending.classList.remove('hidden');
      
      // 确定结局
      const character = gameData.characters[gameData.currentCharacter];
      let ending = gameData.endings[0]; // 默认结局
      
      for (let i = gameData.endings.length - 1; i >= 0; i--) {
        if (character.affection >= gameData.endings[i].affectionRequired) {
          ending = gameData.endings[i];
          break;
        }
      }
      
      // 更新结局信息
      uiElements.endingImage.src = ending.image;
      uiElements.endingTitle.textContent = ending.title;
      uiElements.endingDescription.textContent = ending.description;
      
      // 清除保存的游戏数据
      localStorage.removeItem('loveSimulationGame');
    }
    
    // 隐藏所有页面
    function hideAllPages() {
      Object.values(pages).forEach(page => {
        page.classList.add('hidden');
      });
    }
    
    // 显示指定区域
    function showSection(section) {
      // 隐藏所有区域
      Object.values(sections).forEach(sec => {
        sec.classList.add('hidden');
      });
      
      // 显示指定区域
      sections[section].classList.remove('hidden');
      gameState.currentSection = section;
    }
    
    // 渲染对话区域
    function renderDialogSection() {
      const character = gameData.characters[gameData.currentCharacter];
      const dialogue = character.dialogues[gameState.currentDialogueId];
      
      // 清空对话容器
      dialogElements.container.innerHTML = '';
      
      // 添加对话内容
      const dialogueBox = document.createElement('div');
      dialogueBox.className = 'dialog-box';
      dialogueBox.innerHTML = `
        <div class="flex items-start">
          <img src="${character.image}" alt="${character.name}" class="w-12 h-12 rounded-full object-cover mr-3">
          <div>
            <div class="flex items-center mb-1">
              <span class="font-bold mr-2">${character.name}</span>
              <span class="text-xs text-gray-500">${gameData.day}天</span>
            </div>
            <p>${dialogue.text}</p>
          </div>
        </div>
      `;
      dialogElements.container.appendChild(dialogueBox);
      
      // 滚动到底部
      dialogElements.container.scrollTop = dialogElements.container.scrollHeight;
      
      // 添加对话选项
      dialogElements.options.innerHTML = '';
      dialogue.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'btn-outline text-left';
        button.textContent = option.text;
        button.addEventListener('click', () => {
          // 更新好感度
          character.affection += option.affectionChange;
          if (character.affection > 100) character.affection = 100;
          if (character.affection < 0) character.affection = 0;
          
          // 记录互动
          recordInteraction(`对话中选择了"${option.text}"`, character.name, option.affectionChange);
          
          // 根据选项内容提供线索
          provideClueBasedOnDialogue(character.id, option.text, option.affectionChange);
          
          // 更新好感UI
          updateUI();
          
          // 保存游戏
          saveGame();
          
          // 检查是否达成结局
          if (checkEnding()) {
            return;
          }
          
          // 切换到下一个对话
          gameState.currentDialogueId = (gameState.currentDialogueId + 1) % character.dialogues.length;
          
          // 增加天数
          gameData.day++;
          
          // 随机触发事件
          if (Math.random() > 0.7) {
            triggerRandomEvent();
          }
          
          // 更新UI
          updateUI();
          
          // 保存游戏
          saveGame();
          
          // 重新渲染对话区域
          renderDialogSection();
        });
        dialogElements.options.appendChild(button);
      });
    }
    
    // 根据对话提供线索
    function provideClueBasedOnDialogue(characterId, optionText, affectionChange) {
      const character = gameData.characters[characterId];
      
      // 根据不同角色和选项提供不同线索
      if (affectionChange > 2) {
        let clue = '';
        
        if (characterId === 0 && (optionText.includes('书籍') || optionText.includes('咖啡') || optionText.includes('音乐'))) {
          clue = `${character.name}似乎对${optionText.split('"')[1]}很感兴趣`;
        } else if (characterId === 1 && (optionText.includes('运动') || optionText.includes('游戏') || optionText.includes('电子产品'))) {
          clue = `${character.name}提到他喜欢${optionText.split('"')[1]}`;
        } else if (characterId === 2 && (optionText.includes('红酒') || optionText.includes('书法') || optionText.includes('艺术'))) {
          clue = `${character.name}对${optionText.split('"')[1]}有研究`;
        } else if (characterId === 3 && (optionText.includes('甜点') || optionText.includes('小猫') || optionText.includes('手工'))) {
          clue = `${character.name}很高兴你提到了${optionText.split('"')[1]}`;
        } else if (characterId === 4 && (optionText.includes('户外') || optionText.includes('乐器') || optionText.includes('摄影'))) {
          clue = `${character.name}兴奋地讨论起${optionText.split('"')[1]}`;
        }
        
        if (clue) {
          addClue(clue, characterId);
        }
      }
    }
    
    // 渲染送礼区域
    function renderGiftSection() {
      const giftContainer = sections.gift.querySelector('.grid');
      giftContainer.innerHTML = '';
      
      gameData.gifts.forEach(gift => {
        const giftCard = document.createElement('div');
        giftCard.className = 'gift-card';
        
        // 检查是否买得起
        const isAffordable = gameData.money >= gift.price;
        
        giftCard.innerHTML = `
          <div class="flex items-center mb-2">
            <i class="fa fa-gift text-primary mr-2"></i>
            <h4 class="font-bold">${gift.name}</h4>
          </div>
          <p class="text-sm text-gray-600 mb-2">一个精美的${gift.name}</p>
          <div class="flex justify-end items-center">
            <span class="text-sm font-bold ${isAffordable ? 'text-green-600' : 'text-red-600'}">${gift.price}元</span>
          </div>
        `;
        
        // 添加点击事件
        if (isAffordable) {
          giftCard.addEventListener('click', () => {
            // 消耗金钱
            gameData.money -= gift.price;
            
            // 检查角色是否喜欢这个礼物
            const character = gameData.characters[gameData.currentCharacter];
            const isLiked = gift.likedBy.includes(character.id);
            const affectionChange = isLiked ? gift.affectionChange * 2 : gift.affectionChange;
            
            // 增加好感度
            character.affection += affectionChange;
            if (character.affection > 100) character.affection = 100;
            
            // 记录互动
            recordInteraction(`赠送了${gift.name}`, character.name, affectionChange);
            
            // 显示提示
            showGiftSuccess(gift.name, gift.reaction);
            
            // 如果是喜欢的礼物，添加线索
            if (isLiked) {
              addClue(`${character.name}似乎喜欢${gift.name}`, character.id);
            }
            
            // 更新UI
            updateUI();
            
            // 保存游戏
            saveGame();
            
            // 检查是否达成结局
            if (checkEnding()) {
              return;
            }
            
            // 增加天数
            gameData.day++;
            
            // 更新UI
            updateUI();
            
            // 保存游戏
            saveGame();
            
            // 切换回对话区域
            showSection('dialog');
            renderDialogSection();
          });
        } else {
          giftCard.classList.add('opacity-50');
          giftCard.classList.add('cursor-not-allowed');
        }
        
        giftContainer.appendChild(giftCard);
      });
    }
    
    // 渲染打工区域
    function renderWorkSection() {
      const workContainer = sections.work.querySelector('.grid');
      workContainer.innerHTML = '';
      
      gameData.jobs.forEach(job => {
        const jobCard = document.createElement('div');
        jobCard.className = 'job-card';
        
        jobCard.innerHTML = `
          <div class="flex items-center mb-2">
            <i class="fa fa-briefcase text-secondary mr-2"></i>
            <h4 class="font-bold">${job.name}</h4>
          </div>
          <p class="text-sm text-gray-600 mb-2">${job.description}</p>
          <div class="flex justify-between items-center">
            <div class="flex items-center">
              <i class="fa fa-clock-o text-gray-500 mr-1"></i>
              <span class="text-sm">${job.time}天</span>
            </div>
            <div class="flex items-center">
              <i class="fa fa-money text-green-600 mr-1"></i>
              <span class="text-sm font-bold">${job.pay}元</span>
            </div>
          </div>
        `;
        
        // 添加点击事件
        jobCard.addEventListener('click', () => {
          // 增加金钱
          gameData.money += job.pay;
          
          // 显示提示
          showWorkSuccess(job.name, job.pay);
          
          // 增加天数
          gameData.day += job.time;
          
          // 更新UI
          updateUI();
          
          // 保存游戏
          saveGame();
          
          // 切换回对话区域
          showSection('dialog');
          renderDialogSection();
        });
        
        workContainer.appendChild(jobCard);
      });
    }
    
    // 显示送礼成功提示
    function showGiftSuccess(giftName, reaction) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg bg-green-500 text-white max-w-xs';
      notification.innerHTML = `
        <div class="flex items-start">
          <i class="fa fa-gift mr-2 mt-1"></i>
          <div>
            <p class="font-bold">赠送${giftName}成功！</p>
            <p class="text-sm">${reaction}</p>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // 添加动画
      notification.style.transition = 'all 0.3s ease';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(-20px)';
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // 5秒后移除
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 5000);
    }
    
    // 显示打工成功提示
    function showWorkSuccess(jobName, pay) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg bg-blue-500 text-white';
      notification.textContent = `完成${jobName}！获得${pay}元`;
      
      document.body.appendChild(notification);
      
      // 添加动画
      notification.style.transition = 'all 0.3s ease';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(-20px)';
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // 3秒后移除
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // 检查是否达成结局
    function checkEnding() {
      // 游戏天数超过30天，或者好感度达到100，结束游戏
      if (gameData.day > 30 || (gameData.currentCharacter !== null && gameData.characters[gameData.currentCharacter].affection >= 100)) {
        showEndingPage();
        return true;
      }
      return false;
    }
    
    // 重新开始游戏
    function restartGame() {
      // 重置游戏数据
      gameData.money = 500;
      gameData.day = 1;
      gameData.currentCharacter = null;
      gameData.clues = [];
      gameData.interactions = [];
      
      // 重置角色数据
      gameData.characters.forEach(character => {
        character.affection = 0;
      });
      
      // 重置游戏状态
      gameState.currentDialogueId = 0;
      gameState.currentSection = 'dialog';
      
      // 保存游戏
      saveGame();
      
      // 更新UI
      updateUI();
      
      // 显示角色选择页面
      showCharacterSelectionPage();
    }
    
    // 添加线索
    function addClue(text, characterId) {
      // 检查是否已经有相同的线索
      const existingClue = gameData.clues.find(clue => clue.text === text && clue.characterId === characterId);
      if (existingClue) return;
      
      gameData.clues.push({
        text,
        characterId,
        day: gameData.day
      });
      
      // 更新角色详情页面的线索
      updateCharacterClues();
    }
    
    // 更新角色详情页面的线索
    function updateCharacterClues() {
      const characterClues = document.getElementById('character-clues');
      characterClues.innerHTML = '';
      
      const characterId = gameData.currentCharacter;
      const clues = gameData.clues.filter(clue => clue.characterId === characterId);
      
      if (clues.length === 0) {
        characterClues.innerHTML = '<span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">暂无线索</span>';
        return;
      }
      
      clues.forEach(clue => {
        const tag = document.createElement('span');
        tag.className = 'bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded m-1';
        tag.textContent = clue.text;
        characterClues.appendChild(tag);
      });
    }
    
    // 记录互动
    function recordInteraction(action, characterName, affectionChange) {
      let feeling = '';
      if (affectionChange > 5) feeling = '非常开心';
      else if (affectionChange > 2) feeling = '很开心';
      else if (affectionChange > 0) feeling = '有些开心';
      else if (affectionChange === 0) feeling = '没有特别感觉';
      else feeling = '不太开心';
      
      gameData.interactions.push({
        action,
        characterName,
        day: gameData.day,
        feeling
      });
    }
    
    // 更新日记
    function updateDiary() {
      // 更新线索
      const cluesContainer = uiElements.diaryClues;
      cluesContainer.innerHTML = '';
      
      const characterId = gameData.currentCharacter;
      const clues = gameData.clues.filter(clue => clue.characterId === characterId);
      
      if (clues.length === 0) {
        cluesContainer.innerHTML = '<p class="text-gray-500">你还没有收集到任何线索...</p>';
      } else {
        const cluesList = document.createElement('ul');
        cluesList.className = 'list-disc list-inside';
        
        clues.forEach(clue => {
          const clueItem = document.createElement('li');
          clueItem.className = 'text-sm mb-1';
          clueItem.textContent = `第${clue.day}天：${clue.text}`;
          cluesList.appendChild(clueItem);
        });
        
        cluesContainer.appendChild(cluesList);
      }
      
      // 更新互动记录
      const interactionsContainer = uiElements.diaryInteractions;
      interactionsContainer.innerHTML = '';
      
      const interactions = gameData.interactions.filter(interaction => interaction.characterName === gameData.characters[characterId].name);
      
      if (interactions.length === 0) {
        interactionsContainer.innerHTML = '<p class="text-gray-500">你还没有与他/她互动...</p>';
      } else {
        const interactionsList = document.createElement('ul');
        interactionsList.className = 'space-y-2';
        
        interactions.forEach(interaction => {
          const interactionItem = document.createElement('li');
          interactionItem.className = 'p-2 bg-white rounded shadow-sm';
          interactionItem.innerHTML = `
            <div class="flex justify-between items-center">
              <span class="font-bold">第${interaction.day}天</span>
              <span class="text-xs text-gray-500">${interaction.feeling}</span>
            </div>
            <p class="text-sm">${interaction.action}</p>
          `;
          interactionsList.appendChild(interactionItem);
        });
        
        interactionsContainer.appendChild(interactionsList);
      }
    }
    
    // 渲染约会区域
    function renderDateSection() {
      const dateContainer = sections.date.querySelector('.grid');
      dateContainer.innerHTML = '';
      
      gameData.dates.forEach(date => {
        const dateCard = document.createElement('div');
        dateCard.className = 'job-card';
        
        // 检查是否买得起
        const isAffordable = gameData.money >= date.price;
        
        dateCard.innerHTML = `
          <div class="flex items-center mb-2">
            <i class="fa fa-heart text-accent mr-2"></i>
            <h4 class="font-bold">${date.name}</h4>
          </div>
          <p class="text-sm text-gray-600 mb-2">${date.description}</p>
          <div class="flex justify-between items-center">
            <div class="flex items-center">
              <i class="fa fa-clock-o text-gray-500 mr-1"></i>
              <span class="text-sm">${date.time}天</span>
            </div>
            <div class="flex items-center">
              <i class="fa fa-money text-green-600 mr-1"></i>
              <span class="text-sm font-bold ${isAffordable ? 'text-green-600' : 'text-red-600'}">${date.price}元</span>
            </div>
          </div>
        `;
        
        // 添加点击事件
        if (isAffordable) {
          dateCard.addEventListener('click', () => {
            // 消耗金钱
            gameData.money -= date.price;
            
            // 检查角色是否喜欢这个约会地点
            const character = gameData.characters[gameData.currentCharacter];
            const isLiked = date.likedBy.includes(character.id);
            const affectionChange = isLiked ? 5 + Math.floor(Math.random() * 5) : 1 + Math.floor(Math.random() * 3);
            
            // 增加好感度
            character.affection += affectionChange;
            if (character.affection > 100) character.affection = 100;
            
            // 记录互动
            recordInteraction(`一起去${date.name}约会`, character.name, affectionChange);
            
            // 显示提示
            showDateSuccess(date.name, isLiked ? date.reactions.like : date.reactions.dislike);
            
            // 如果是喜欢的约会地点，添加线索
            if (isLiked) {
              addClue(`${character.name}似乎喜欢去${date.name}`, character.id);
            }
            
            // 更新UI
            updateUI();
            
            // 保存游戏
            saveGame();
            
            // 检查是否达成结局
            if (checkEnding()) {
              return;
            }
            
            // 增加天数
            gameData.day += date.time;
            
            // 更新UI
            updateUI();
            
            // 保存游戏
            saveGame();
            
            // 切换回对话区域
            showSection('dialog');
            renderDialogSection();
          });
        } else {
          dateCard.classList.add('opacity-50');
          dateCard.classList.add('cursor-not-allowed');
        }
        
        dateContainer.appendChild(dateCard);
      });
    }
    
    // 显示约会成功提示
    function showDateSuccess(dateName, reaction) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg bg-accent text-white max-w-xs';
      notification.innerHTML = `
        <div class="flex items-start">
          <i class="fa fa-heart mr-2 mt-1"></i>
          <div>
            <p class="font-bold">约会成功！</p>
            <p class="text-sm">${reaction}</p>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // 添加动画
      notification.style.transition = 'all 0.3s ease';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(-20px)';
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // 5秒后移除
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 5000);
    }
    
    // 触发随机事件
    function triggerRandomEvent() {
      const character = gameData.characters[gameData.currentCharacter];
      
      // 随机事件列表
      const events = [
        {
          title: "意外相遇",
          description: `在${character.name}常去的地方偶然遇到了他/她。`,
          options: [
            { text: "主动打招呼", affectionChange: 3 },
            { text: "假装没看见", affectionChange: -1 },
            { text: "邀请一起活动", affectionChange: 5 }
          ]
        },
        {
          title: "共同兴趣",
          description: `${character.name}提到了一个你也感兴趣的话题。`,
          options: [
            { text: "深入讨论", affectionChange: 4 },
            { text: "简单回应", affectionChange: 1 },
            { text: "转移话题", affectionChange: -2 }
          ]
        },
        {
          title: "帮助",
          description: `${character.name}遇到了一点小麻烦，需要帮助。`,
          options: [
            { text: "主动帮忙", affectionChange: 5 },
            { text: "找借口推脱", affectionChange: -3 },
            { text: "提供建议", affectionChange: 2 }
          ]
        }
      ];
      
      // 随机选择一个事件
      const event = events[Math.floor(Math.random() * events.length)];
      
      // 创建事件弹窗
      const eventModal = document.createElement('div');
      eventModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      eventModal.innerHTML = `
        <div class="bg-white rounded-xl shadow-lg p-6 max-w-md w-full">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-primary">${event.title}</h3>
            <button id="close-event" class="text-gray-500 hover:text-gray-700">
              <i class="fa fa-times"></i>
            </button>
          </div>
          <p class="mb-4">${event.description}</p>
          <div class="grid grid-cols-1 gap-3" id="event-options">
            <!-- 事件选项将通过JS动态添加 -->
          </div>
        </div>
      `;
      
      document.body.appendChild(eventModal);
      
      // 添加事件选项
      const eventOptions = document.getElementById('event-options');
      event.options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'btn-outline text-left';
        button.textContent = option.text;
        button.addEventListener('click', () => {
          // 更新好感度
          character.affection += option.affectionChange;
          if (character.affection > 100) character.affection = 100;
          if (character.affection < 0) character.affection = 0;
          
          // 记录互动
          recordInteraction(`在"${event.title}"事件中选择了"${option.text}"`, character.name, option.affectionChange);
          
          // 显示事件结果提示
          let feeling = '';
          if (option.affectionChange > 3) feeling = '非常开心';
          else if (option.affectionChange > 0) feeling = '很开心';
          else if (option.affectionChange === 0) feeling = '没有特别感觉';
          else feeling = '不太开心';
          
          showEventResult(event.title, feeling);
          
          // 更新UI
          updateUI();
          
          // 保存游戏
          saveGame();
          
          // 移除弹窗
          document.body.removeChild(eventModal);
        });
        eventOptions.appendChild(button);
      });
      
      // 关闭按钮
      document.getElementById('close-event').addEventListener('click', () => {
        document.body.removeChild(eventModal);
      });
    }
    
    // 显示事件结果提示
    function showEventResult(eventTitle, feeling) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 px-4 py-2 rounded-lg bg-blue-500 text-white';
      notification.textContent = `"${eventTitle}"事件结束，他/她看起来${feeling}。`;
      
      document.body.appendChild(notification);
      
      // 添加动画
      notification.style.transition = 'all 0.3s ease';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(-20px)';
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // 3秒后移除
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // 初始化游戏
    window.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>
